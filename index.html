<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3 Teste Template</title>
		<script type="text/javascript" src="d3/d3.js"></script>

		<style type="text/css">	
			div.bar {
			display: inline-block;
			width: 20px;
			height: 75px; /* We'll override height later */
			background-color: teal;
			margin-right: 2px;
			}

			.axis path,
			.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
			}
			.axis text {
			font-family: sans-serif;
			font-size: 11px;
			fill: black;
			}

			.caption {
			text-align: center;
			}

			circle:hover {
				fill: orange;
			}

			#tooltip {
				position: absolute;
				width: 200px;
				height: auto;
				padding: 10px;
				background-color: white;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
				-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}
			
			#tooltip.hidden {
				display: none;
			}
			
			#tooltip p {
				margin: 0;
				font-family: sans-serif;
				font-size: 10px;
				line-height: 16px;
			}

		</style>

	</head>
	<body>

	<p>Click to sort!!</p>

	<div id="tooltip" class="hidden">
			<p><strong>Value:</strong></p>
			<p><span id="value">100</span>%</p>
			<img id="padr" src="xsb_mmorph37660_001.png" alt="Segmentation" style="width:200px;height:100px;">
			<div class="caption">REFERENCE</div>
			<img id="segm" src="xsb_mmorph37660_001.png" alt="Segmentation" style="width:200px;height:100px;">
			<div class="caption">SEGMENTATION</div>
	</div>

	<script type="text/javascript">	

		var sortpoints = function() {
			svg.select(".point")
			   .sort(function(a, b) {return d3.ascending(a, b);})
			   .transition()
			   .duration(1000)
			   .delay(function(d, i) {return i / 150000;})//d.length * 1000;})
			   //.on("start", function() {d3.select(this).attr("fill", "magenta").attr("r", 3);})
			   .attr("cx", 100)
			   .attr("cy", 0.5);
			   //.on("end", function() {d3.select(this).transition().duration(1000).attr("fill", "blue");});;
			};		

		var w = 800;
		var h = 500;
		var padding = 30;

		//Define scale
		var x = d3.scaleLinear().range([padding, w-padding*2]);
		var y = d3.scaleLinear().range([h-padding, padding]);
		var z = d3.scaleOrdinal(d3.schemeCategory10);

		var xAxis = d3.axisBottom().scale(x).ticks(10);
		var yAxis = d3.axisLeft().scale(y).ticks(5);

		//Define Canvas		
		var svg = d3.select("body").append("svg").attr("width", w).attr("height", h)
		
		//Define clipping path
		svg.append("clipPath").attr("id", "chart-area").append("rect")
		.attr("x", padding).attr("y", padding).attr("width", w - padding*3).attr("height", h - padding*2);

		//Loading CSV
		d3.csv("eval_silver_standard.csv", function(error, data){
			if (error) throw error;

			// Extract yn using key
			var seriesNames = d3.keys(data[0])
			.filter(function(d) { return d !== "x"; })
			.sort();

			// Map data to cartesian tuple {x,y}
			var series = seriesNames.map(function(series) {
			return data.map(function(d) {
			return {x: +d.x, y: +d[series]};
			});
			});

		// Compute domains
		x.domain(d3.extent(d3.merge(series), function(d) { return d.x; })).nice();
		y.domain(d3.extent(d3.merge(series), function(d) { return d.y; })).nice();

		// X axis.
		svg.append("g").attr("class", "axis").attr("transform", "translate(0," + (h - padding) + ")").call(xAxis)

		// Y axis.
		svg.append("g").attr("class", "axis").attr("transform", "translate(" + padding + ",0)").call(yAxis)

		// Append circles
		svg.selectAll(".series")
		.data(series)
		.enter().append("g")
		.attr("class", "series")
		.style("fill", function(d, i) { return z(i); })
		.selectAll(".point")
		.data(function(d) { return d; })
		.enter().append("circle")
		.attr("class", "point")
		.attr("cx", function(d) { return x(d.x); })
		.attr("cy", function(d) { return y(d.y); })
		.attr("r", 4)
		.on("mouseover", function(d,i) {
			//Get this bar's x/y values, then augment for the tooltip
			var xPosition = parseFloat(d3.select(this).attr("cx")) + 20;			
			if (d.y>0.5) {
				var yPosition = parseFloat(d3.select(this).attr("cy")) - 10;}
			else {
				var yPosition = parseFloat(d3.select(this).attr("cy")) - 200;}
			var imgpadr = "images/xsb_mmorph37660_"+(1+(i*6))+".png";
			var imgsegm = "images/xsb_mmorph37660_"+(4+(i*6))+".png";

			//tooltip.text("some text");
			//Create the tooltip label
			//Update the tooltip position and value
			d3.select("#tooltip")
			.style("left", xPosition + "px")
			.style("top", yPosition + "px")
			.select("#value")
			.text(d.y);
			d3.select("#tooltip").select("#padr")
			.attr("src",imgpadr);
			d3.select("#tooltip").select("#segm")
			.attr("src",imgsegm);
			//Show the tooltip
			d3.select("#tooltip").classed("hidden", false);
			})
   		.on("mouseout", function() {
		d3.select("#tooltip").classed("hidden", true);
		});
		});

		//On click, update with new data
		d3.select("p").on("click", function() {
			sortpoints();
		});

	</script>

	</body>
</html>
